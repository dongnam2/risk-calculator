<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, viewport-fit=cover">
  <meta name="apple-mobile-web-app-capable" content="yes">
  <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
  <meta name="apple-mobile-web-app-title" content="3STEP CALC">
  <meta name="theme-color" content="#0f172a">
  <title>3STEP POSITION CALC PRO</title>

  <style>
    :root { --main-color: #00eaff; --bg-color: #0f172a; --card-bg: #1e293b; --accent: #fbbf24; --copy-btn: #3b82f6; }
    html { -webkit-text-size-adjust: 100%; }
    body { font-family: -apple-system, sans-serif; background-color: var(--bg-color); color: white; margin: 0; padding: 20px; display: flex; justify-content: center; padding-top: calc(20px + env(safe-area-inset-top)); }
    .container { width: 100%; max-width: 450px; background: var(--card-bg); padding: 25px; border-radius: 20px; box-shadow: 0 10px 30px rgba(0,0,0,0.5); }
    h2 { text-align: center; color: var(--main-color); margin-bottom: 20px; font-weight: 800; letter-spacing: -1px; }
    .section-title { font-size: 14px; color: var(--main-color); margin-bottom: 10px; font-weight: bold; border-left: 4px solid var(--main-color); padding-left: 8px; }
    .input-group { margin-bottom: 12px; }
    label { display: block; margin-bottom: 5px; font-size: 12px; color: #94a3b8; }
    input { width: 100%; padding: 12px; box-sizing: border-box; border-radius: 10px; border: 1px solid #334155; background: #0f172a; color: white; font-size: 16px; outline: none; }
    input:focus { border-color: var(--main-color); }
    input[readonly] { opacity: 0.85; border-style: dashed; cursor: default; }
    .entry-grid { display: grid; grid-template-columns: 1fr 1fr 1fr; gap: 8px; margin-bottom: 15px; }
    button { width: 100%; padding: 16px; border: none; border-radius: 12px; background: var(--main-color); color: #0f172a; font-weight: bold; font-size: 17px; cursor: pointer; margin-top: 10px; }
    .btn-copy { background: var(--copy-btn); color: white; display: none; margin-top: 8px; }
    .result { margin-top: 25px; padding: 20px; background: #334155; border-radius: 12px; display: none; }
    .res-row { display: flex; justify-content: space-between; margin-bottom: 10px; font-size: 14px; }
    .res-val { font-weight: bold; color: var(--main-color); }
    .highlight-box { background: #1e293b; padding: 12px; border-radius: 8px; margin-top: 10px; border-left: 4px solid var(--accent); }
    .warning { color: #ff4444; font-size: 11px; text-align: center; margin-top: 15px; line-height: 1.4; }
  </style>
</head>
<body>
  <div class="container">
    <h2>3-STEP POSITION CALC</h2>

    <div class="section-title">기본 정보 (손실 2% 고정)</div>
    <div class="entry-grid" style="grid-template-columns: 1fr 1fr;">
      <div class="input-group"><label>총 시드 (USDT)</label><input type="number" id="seed" value="2000" readonly></div>
      <div class="input-group"><label>레버리지 (배)</label><input type="number" id="leverage" value="100" readonly></div>
    </div>

    <div class="input-group">
      <div class="section-title">거래 코인 (Symbol)</div>
      <input type="text" id="symbol" value="BTC/USDT" placeholder="예: BTC/USDT">
    </div>

    <div class="section-title">진입 가격 (1~3차)</div>
    <div class="entry-grid">
      <div class="input-group"><label>1차 진입</label><input type="number" id="e1" placeholder="필수" inputmode="decimal"></div>
      <div class="input-group"><label>2차 진입</label><input type="number" id="e2" placeholder="선택" inputmode="decimal"></div>
      <div class="input-group"><label>3차 진입</label><input type="number" id="e3" placeholder="선택" inputmode="decimal"></div>
    </div>

    <div class="input-group">
      <div class="section-title">손절 가격 (Stop Loss)</div>
      <input type="number" id="stop" placeholder="손절가 입력" inputmode="decimal">
    </div>

    <button onclick="calculate()">포지션 상세 계산</button>
    <button id="copyBtn" class="btn-copy" onclick="copyCommand()">주문 명령어 복사하기</button>

    <div class="result" id="resultArea">
      <div class="res-row"><span>감수할 손실 (2%)</span><span class="res-val" id="resRisk" style="color:#ef4444;">0</span></div>
      <div class="res-row"><span>평균 진입 단가</span><span class="res-val" id="resAvgEntry">0</span></div>
      <div class="res-row" style="background:#2d3748; padding:5px; border-radius:4px;">
        <span>총 포지션 사이즈</span><span class="res-val" id="resTotalSize" style="color:#00ff88;">0</span>
      </div>
      <div class="highlight-box">
        <div class="res-row"><span>회차별 수량</span><span class="res-val" id="resPerQty">0</span></div>
        <div class="res-row"><span>회차별 증거금</span><span class="res-val" id="resPerMargin">0</span></div>
      </div>
      <div class="warning">※ 복사된 명령어를 텔레그램 봇에게 전송하세요.</div>
    </div>
  </div>

  <script>
    function calculate() {
      const stop = parseFloat(document.getElementById('stop').value);
      const entries = [
        parseFloat(document.getElementById('e1').value),
        parseFloat(document.getElementById('e2').value),
        parseFloat(document.getElementById('e3').value)
      ].filter(val => !isNaN(val) && val > 0);

      if (!stop || entries.length === 0) {
        alert("진입가와 손절가를 입력해주세요!");
        return;
      }

      const avgEntry = entries.reduce((a, b) => a + b, 0) / entries.length;
      const totalRisk = 2000 * 0.02;
      const priceDiff = Math.abs(avgEntry - stop);
      const totalQty = totalRisk / priceDiff;
      const totalSize = totalQty * avgEntry;
      const perQty = totalQty / entries.length;
      const perMargin = (perQty * avgEntry) / 100;

      document.getElementById('resRisk').innerText = totalRisk + " USDT";
      document.getElementById('resAvgEntry').innerText = avgEntry.toFixed(2);
      document.getElementById('resTotalSize').innerText = totalSize.toFixed(2) + " USDT";
      document.getElementById('resPerQty').innerText = perQty.toFixed(4);
      document.getElementById('resPerMargin').innerText = perMargin.toFixed(2) + " USDT";

      document.getElementById('resultArea').style.display = "block";
      document.getElementById('copyBtn').style.display = "block";
    }

    function copyCommand() {
      const symbol = document.getElementById('symbol').value;
      const stop = document.getElementById('stop').value;
      const qty = document.getElementById('resPerQty').innerText;
      const entries = [
        document.getElementById('e1').value,
        document.getElementById('e2').value,
        document.getElementById('e3').value
      ].filter(v => v !== "");

      const command = `[ORDER]|${symbol}|${entries.join(",")}|${qty}|${stop}`;

      navigator.clipboard.writeText(command).then(() => {
        alert("명령어가 복사되었습니다!\n텔레그램 봇에 붙여넣으세요.\n\n" + command);
      });
    }
  </script>
</body>
</html>
