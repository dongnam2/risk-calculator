<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="UTF-8" />

  <!-- iPhone í™ˆí™”ë©´ ì›¹ì•± ìµœì í™” -->
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, viewport-fit=cover">
  <meta name="apple-mobile-web-app-capable" content="yes">
  <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
  <meta name="apple-mobile-web-app-title" content="3STEP CALC">
  <meta name="theme-color" content="#0f172a">
  <link rel="apple-touch-icon" href="icon-180.png">

  <title>3ë¶„í•  ë¦¬ìŠ¤í¬ ê³„ì‚°ê¸° PRO</title>

  <style>
    :root { --main-color: #00eaff; --bg-color: #0f172a; --card-bg: #1e293b; --accent: #fbbf24; }

    /* iOS ê¸€ì ìë™í™•ëŒ€/ë ˆì´ì•„ì›ƒ íŠ ë°©ì§€ */
    html { -webkit-text-size-adjust: 100%; }

    body {
      font-family: -apple-system, sans-serif;
      background-color: var(--bg-color);
      color: white;
      margin: 0;
      padding: 20px;
      display: flex;
      justify-content: center;
      padding-top: calc(20px + env(safe-area-inset-top));
      padding-bottom: calc(20px + env(safe-area-inset-bottom));
    }

    .container {
      width: 100%;
      max-width: 450px;
      background: var(--card-bg);
      padding: 25px;
      border-radius: 20px;
      box-shadow: 0 10px 30px rgba(0,0,0,0.5);
    }

    h2 { text-align: center; color: var(--main-color); margin-bottom: 20px; font-weight: 800; letter-spacing: -1px; }
    .section-title { font-size: 14px; color: var(--main-color); margin-bottom: 10px; font-weight: bold; border-left: 4px solid var(--main-color); padding-left: 8px; }
    .input-group { margin-bottom: 12px; }
    label { display: block; margin-bottom: 5px; font-size: 12px; color: #94a3b8; }

    /* í•µì‹¬: iOS ìë™ì¤Œ ë°©ì§€í•˜ë ¤ë©´ input í°íŠ¸ 16px ì´ìƒ */
    input {
      width: 100%;
      padding: 12px;
      box-sizing: border-box;
      border-radius: 10px;
      border: 1px solid #334155;
      background: #0f172a;
      color: white;
      font-size: 16px; /* 15 -> 16 */
      outline: none;
    }
    input:focus { border-color: var(--main-color); }

    /* ê³ ì •ê°’(ì ê¸ˆ) input ì‹œê° ì²˜ë¦¬ */
    input[readonly] {
      opacity: 0.85;
      border-style: dashed;
      cursor: default;
    }

    .entry-grid { display: grid; grid-template-columns: 1fr 1fr 1fr; gap: 8px; margin-bottom: 15px; }

    button { width: 100%; padding: 16px; border: none; border-radius: 12px; background: var(--main-color); color: #0f172a; font-weight: bold; font-size: 17px; cursor: pointer; margin-top: 10px; }

    .result { margin-top: 25px; padding: 20px; background: #334155; border-radius: 12px; display: none; }
    .res-header { font-size: 16px; font-weight: bold; margin-bottom: 15px; text-align: center; color: #f8fafc; border-bottom: 1px solid #475569; padding-bottom: 10px; }
    .res-row { display: flex; justify-content: space-between; margin-bottom: 10px; font-size: 14px; }
    .res-val { font-weight: bold; color: var(--main-color); }
    .highlight-box { background: #1e293b; padding: 12px; border-radius: 8px; margin-top: 10px; border-left: 4px solid var(--accent); }
    .split-title { font-size: 13px; font-weight: bold; color: var(--accent); margin-bottom: 8px; }
    .warning { color: #ff4444; font-size: 11px; text-align: center; margin-top: 15px; line-height: 1.4; }
  </style>
</head>

<body>
  <div class="container">
    <h2>3-STEP POSITION CALC</h2>

    <div class="section-title">ê¸°ë³¸ ì •ë³´ (ì†ì‹¤ 2% ê³ ì •)</div>
    <div class="entry-grid" style="grid-template-columns: 1fr 1fr;">
      <div class="input-group">
        <label>ì´ ì‹œë“œ (USDT) - ê³ ì •</label>
        <input type="number" id="seed" value="2000" readonly inputmode="decimal">
      </div>
      <div class="input-group">
        <label>ë ˆë²„ë¦¬ì§€ (ë°°) - ê³ ì •</label>
        <input type="number" id="leverage" value="100" readonly inputmode="decimal">
      </div>
    </div>

    <div class="section-title">ì§„ì… ê°€ê²© (1~3ì°¨)</div>
    <div class="entry-grid">
      <div class="input-group">
        <label>1ì°¨ ì§„ì…</label>
        <input type="number" id="e1" placeholder="í•„ìˆ˜" inputmode="decimal">
      </div>
      <div class="input-group">
        <label>2ì°¨ ì§„ì…</label>
        <input type="number" id="e2" placeholder="ì„ íƒ" inputmode="decimal">
      </div>
      <div class="input-group">
        <label>3ì°¨ ì§„ì…</label>
        <input type="number" id="e3" placeholder="ì„ íƒ" inputmode="decimal">
      </div>
    </div>

    <div class="input-group">
      <div class="section-title">ì†ì ˆ ê°€ê²© (Stop Loss)</div>
      <input type="number" id="stop" placeholder="ì†ì ˆê°€ ì…ë ¥" inputmode="decimal">
    </div>

    <button onclick="calculate()">í¬ì§€ì…˜ ìƒì„¸ ê³„ì‚°</button>

    <div class="result" id="resultArea">
      <div class="res-header">ğŸ“Š ì „ì²´ í¬ì§€ì…˜ ìš”ì•½</div>
      <div class="res-row">
        <span>ê°ìˆ˜í•  ì†ì‹¤ (2%)</span>
        <span class="res-val" id="resRisk" style="color:#ef4444;">0</span>
      </div>
      <div class="res-row">
        <span>í‰ê·  ì§„ì… ë‹¨ê°€</span>
        <span class="res-val" id="resAvgEntry">0</span>
      </div>
      <div class="res-row" style="background:#2d3748; padding:5px; border-radius:4px;">
        <span>ì´ í¬ì§€ì…˜ ì‚¬ì´ì¦ˆ</span>
        <span class="res-val" id="resTotalSize" style="color:#00ff88;">0</span>
      </div>
      <div class="res-row">
        <span>ì´ ì½”ì¸ ìˆ˜ëŸ‰</span>
        <span class="res-val" id="resTotalQty">0</span>
      </div>
      <div class="res-row">
        <span>ì´ íˆ¬ì… ì¦ê±°ê¸ˆ(Margin)</span>
        <span class="res-val" id="resTotalMargin" style="color:var(--accent);">0</span>
      </div>

      <div class="highlight-box">
        <div class="split-title" id="splitCountText">íšŒì°¨ë³„ ì§„ì… ê°€ì´ë“œ (ê· ë“±)</div>
        <div class="res-row">
          <span>íšŒì°¨ë³„ ì½”ì¸ ìˆ˜ëŸ‰</span>
          <span class="res-val" id="resPerQty">0</span>
        </div>
        <div class="res-row">
          <span>íšŒì°¨ë³„ í¬ì§€ì…˜(USDT)</span>
          <span class="res-val" id="resPerSize">0</span>
        </div>
        <div class="res-row">
          <span>íšŒì°¨ë³„ ì¦ê±°ê¸ˆ(USDT)</span>
          <span class="res-val" id="resPerMargin">0</span>
        </div>
      </div>

      <div class="warning">
        â€» 50~100ë°° ê³ ë°°ìœ¨ ì‚¬ìš© ì‹œ ìŠ¬ë¦¬í”¼ì§€ì— ì£¼ì˜í•˜ì„¸ìš”.<br>
        ê³„ì‚°ëœ ìˆ˜ëŸ‰ì€ ì†ì ˆ ì‹œ ì‹œë“œì˜ 2% ì†ì‹¤ì„ ë³´ì¥í•©ë‹ˆë‹¤.
      </div>
    </div>
  </div>

  <script>
    // ê³ ì •ê°’
    const FIXED_SEED = 2000;
    const FIXED_LEV = 100;

    // iOS í‚¤ë³´ë“œ/ìŠ¤í¬ë¡¤ íŠ ì™„í™”:
    // ì‚¬ìš©ìê°€ ì…ë ¥ì¹¸ì„ íƒ­í–ˆì„ ë•Œ í•´ë‹¹ ìš”ì†Œê°€ ì•ˆì •ì ìœ¼ë¡œ ë³´ì´ë„ë¡ ì‚´ì§ ìŠ¤í¬ë¡¤ ë³´ì •
    function attachIOSFocusFix() {
      const inputs = document.querySelectorAll('input:not([readonly])');
      inputs.forEach((el) => {
        el.addEventListener('focus', () => {
          // iOSì—ì„œ í‚¤ë³´ë“œ ì˜¬ë¼ì˜¤ëŠ” íƒ€ì´ë° ì´í›„ë¡œ ìŠ¤í¬ë¡¤ ì •ë ¬
          setTimeout(() => {
            el.scrollIntoView({ behavior: 'smooth', block: 'center' });
          }, 250);
        }, { passive: true });
      });
    }
    attachIOSFocusFix();

    function calculate() {
      const seed = FIXED_SEED;
      const lev = FIXED_LEV;

      const stop = parseFloat(document.getElementById('stop').value);

      const entries = [
        parseFloat(document.getElementById('e1').value),
        parseFloat(document.getElementById('e2').value),
        parseFloat(document.getElementById('e3').value)
      ].filter(val => !isNaN(val) && val > 0);

      if (!stop || entries.length === 0) {
        alert("ì§„ì…ê°€(ìµœì†Œ 1ê°œ)ì™€ ì†ì ˆê°€ë¥¼ ì…ë ¥í•´ì£¼ì„¸ìš”!");
        return;
      }

      const avgEntry = entries.reduce((a, b) => a + b, 0) / entries.length;
      const totalRisk = seed * 0.02;
      const priceDiff = Math.abs(avgEntry - stop);

      if (priceDiff === 0) {
        alert("ì§„ì…ê°€ì™€ ì†ì ˆê°€ê°€ ê°™ì„ ìˆ˜ ì—†ìŠµë‹ˆë‹¤.");
        return;
      }

      const totalQty = totalRisk / priceDiff;
      const totalSize = totalQty * avgEntry;
      const totalMargin = totalSize / lev;

      const perQty = totalQty / entries.length;
      const perSize = totalSize / entries.length;
      const perMargin = totalMargin / entries.length;

      document.getElementById('resRisk').innerText = totalRisk.toLocaleString() + " USDT";
      document.getElementById('resAvgEntry').innerText = avgEntry.toLocaleString(undefined, { maximumFractionDigits: 4 });
      document.getElementById('resTotalQty').innerText = totalQty.toLocaleString(undefined, { maximumFractionDigits: 4 });
      document.getElementById('resTotalSize').innerText = totalSize.toLocaleString(undefined, { maximumFractionDigits: 2 }) + " USDT";
      document.getElementById('resTotalMargin').innerText = totalMargin.toLocaleString(undefined, { maximumFractionDigits: 2 }) + " USDT";

      document.getElementById('splitCountText').innerText = entries.length + "íšŒ ë¶„í•  ì§„ì… ê°€ì´ë“œ (1íšŒë‹¹)";
      document.getElementById('resPerQty').innerText = perQty.toLocaleString(undefined, { maximumFractionDigits: 4 });
      document.getElementById('resPerSize').innerText = perSize.toLocaleString(undefined, { maximumFractionDigits: 2 }) + " USDT";
      document.getElementById('resPerMargin').innerText = perMargin.toLocaleString(undefined, { maximumFractionDigits: 2 }) + " USDT";

      const resultArea = document.getElementById('resultArea');
      resultArea.style.display = "block";

      // ê³„ì‚° ë²„íŠ¼ ëˆ„ë¥¸ ë’¤ ê²°ê³¼ê°€ ë³´ì´ë„ë¡ ë¶€ë“œëŸ½ê²Œ ì´ë™(í‚¤ë³´ë“œ ë‚´ë ¤ê°„ ìƒíƒœì—ì„œë„ ë³´ê¸° ì¢‹ê²Œ)
      setTimeout(() => {
        resultArea.scrollIntoView({ behavior: "smooth", block: "start" });
      }, 50);
    }
  </script>
</body>
</html>
